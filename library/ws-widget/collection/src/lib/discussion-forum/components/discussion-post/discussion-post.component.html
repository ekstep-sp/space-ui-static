<mat-card class="margin-top-s card-bg">
  <div class="flex postSection">
    <div class="flex flex-middle">
      <ws-widget-user-image class="main-post-user-image mt-1" [userId]="userId" [userName]="post.postCreator.name"
        [imageType]="'name-initial'" [email]="post.postCreator.emailId"></ws-widget-user-image>
      <span *ngIf="post.postCreator.name"
        class="text-base leading-normal font-medium margin-left-s">{{ post.postCreator.name }}</span>
      <span *ngIf="!post.postCreator.name && post.postCreator.emailId"
        class="text-base leading-normal font-medium margin-left-s">{{ post.postCreator.emailId }}
      </span>
    </div>
    <div class="padding-left-s flex flex-end datePost">
      <div class="mat-caption date-color" *ngIf="!post?.lastEdited?.dtLastEdited?.length">
        {{ post?.dtLastModified | date }}
        <ng-container i18n> at </ng-container>
        <ng-container>{{ post?.dtLastModified | date: 'shortTime' }}</ng-container>
      </div>
      <div class="mat-caption date-color" *ngIf="post?.lastEdited?.dtLastEdited?.length">
        {{ post?.lastEdited.dtLastEdited | date }}
        <ng-container i18n> at </ng-container>
        <ng-container>{{ post?.lastEdited.dtLastEdited | date: 'shortTime' }}</ng-container>
      </div>
      <div>
        <button type="button" mat-icon-button [matMenuTriggerFor]="editMenu" name="discussion-post-more-options-button"
          *ngIf="userId === post.postCreator.postCreatorId">
          <mat-icon>more_vertical</mat-icon>
        </button>
      </div>
    </div>
  </div>
  <div class="flex margin-top-s1">
    <div>
    <div *ngIf="!editMode && post.postContent.title.length" class="break-word text-color"
      [innerHTML]="post.postContent.title"></div>
    </div>
    <!-- <mat-chip-list>
      <mat-chip *ngFor="let tag of qnaConversation.mainPost.tags" i18n-matTooltip matTooltip="Associated Tag">
        {{ tag.name }}
      </mat-chip>
    </mat-chip-list> -->
  </div>
  <div *ngIf="post.activity && post.status === 'Active'" class="flex">
      <ws-widget-btn-social-vote [postId]="post.id" [activity]="post.activity" [voteType]="'upVote'"
        [postCreatorId]="post?.postCreator?.postCreatorId" [isDf]="true"></ws-widget-btn-social-vote>
        <div class="write-reply-container flex flex-middle">
            <!-- <ws-widget-user-image class="write-reply-user-image" [userName]="userName" [imageType]="'name-initial'"
              [email]="userEmail" [userId]="userId"></ws-widget-user-image> -->
            <div class="padding-left-m width-expand">
              <div name="discussion-post-respond-toggle-button" [ngClass]="{'active-reply': replyPlaceholderToggler}"
                (click)="replyPlaceholderToggler = !replyPlaceholderToggler" class="write-reply-placeholder" role="button" i18n>
                Reply
              </div>
            </div>
          </div>
  </div>
  <div [hidden]="!replyPlaceholderToggler" class="flex reply-post-sec">
      <!-- [minLength]="'10'" -->
      <div class="flex flex-1">
      <ws-widget-user-image class="write-reply-user-image mr-5 mt-1" [userName]="userName" [imageType]="'name-initial'"
      [email]="userEmail" [userId]="userId"></ws-widget-user-image>
      <div class="custom-wrap width-expand flex">
      <ws-widget-editor-quill class="write-reply-editor width-expand" 
      [showMention]="allowMention"
      (mentionsData)="replyCommentMentions = $event"
      (textData)="onReplyTextChange($event)"
      [placeholdercss]="true"
      [isDf]="true"
      [isDfPost]="true"
      #discussionReplyEditor></ws-widget-editor-quill>
      <!-- <div class="text-right padding-top-s mat-app-background"> -->
        <a name="discussion-post-reply-button" class="btn-send" [disableRipple]="true"
          (click)="publishReply(editFailMsg.value)" style="background: transparent !important;" type="button cancel-btn" mat-flat-button  i18n>
          <mat-icon [ngClass]="{'disabled': !isValidReply || isPostingReply}" class="send-icon mt-3 line matdark material-icons-outlined">send</mat-icon>
        </a>
      </div>
    </div>
        <a name="discussion-post-cancel-reply-button" type="button" class="margin-left-xs cancel-btn-2" mat-flat-button
        (click)="replyPlaceholderToggler = !replyPlaceholderToggler" i18n>
        Cancel
      </a>
        <!-- <div *ngIf="isPostingReply" class="text-center">
          <mat-spinner class="display-inline-block" [diameter]="30" [strokeWidth]="3"></mat-spinner>
        </div> -->
      <!-- </div> -->
    </div>
  
  <div *ngIf="editMode" class="margin-top-s padding-s mat-primary-border flex">
    <!-- [minLength]="'10'" -->
    <div class="custom-wrap flex flex-1">
    <ws-widget-editor-quill
    [showMention]="allowMention"
    [isDf]="true"
    [isDfPost]="true"
    class="flex-1"
    (mentionsData)="replyEditMentions = $event"
     [htmlText]="post.postContent.title" (textData)="onTextChange($event)">
    </ws-widget-editor-quill>
    <button type="button" name="discussion-post-update-button" class="margin-top-s btn-styles"
    mat-flat-button i18n (click)="editPost(editFailMsg.value)">
    <mat-icon [ngClass]="{'disabled': !postPublishEnabled }" class="send-icon line matdark material-icons-outlined">send</mat-icon>
    </button>
    </div>
    <div class="text-right">
      <button type="button" name="discussion-post-cancel-button" class="margin-top-s btn-styles margin-left-s" mat-flat-button
         i18n (click)="editMode = false">
        Cancel
      </button>
    </div>
  </div>
  <!-- <span class="flex flex-between" *ngIf="post.activity && post.status === 'Active'">
    <span>
      <ws-widget-btn-social-vote class="margin-left-xs" [postId]="post.id" [activity]="post.activity" [voteType]="'downVote'" [postCreatorId]="post?.postCreator?.postCreatorId">
      </ws-widget-btn-social-vote>
    </span>
    <ws-widget-btn-social-like [postId]="post.id" [postCreatorId]="post?.postCreator?.postCreatorId" [activity]="post.activity">
    </ws-widget-btn-social-like>
  </span> -->

  <ws-widget-discussion-reply  (triggerReplyNotification)="triggerReplyCommentNotification($event)" *ngFor="let reply of postReplies; let i = index" [reply]="reply" [allowMention]="allowMention"
    (deleteSuccess)="onDeleteReply(i)" [parentPostCreatorId]="parentPostCreatorId"></ws-widget-discussion-reply>
  <!-- <div *ngIf="replyFetchStatus === 'fetching'" class="margin-top-s text-center">
    <mat-spinner class="display-inline-block" [diameter]="30" [strokeWidth]="3"></mat-spinner>
    <div class="mat-caption" class="margin-top-xs">Fetching replies</div>
  </div> -->
  <div *ngIf="replyFetchStatus === 'hasMore' || isNewRepliesAvailable"
    class="text-center margin-top-xs margin-bottom-s flex flex-end extra-btn">
    <button name="discussion-post-load-previous-replies-button" type="button" mat-flat-button 
      *ngIf="replyFetchStatus === 'hasMore'" class="btn-styles" (click)="fetchPostReplies()" i18n>
      Load Previous Replies
    </button>
    <button name="discussion-post-load-new-replies-button" type="button" mat-flat-button 
      *ngIf="isNewRepliesAvailable" class="btn-styles" (click)="fetchPostReplies(true)" i18n>
      Load New Replies
    </button>
  </div>
</mat-card>

<mat-menu #editMenu="matMenu">
  <ng-template matMenuContent>
    <button name="discussion-post-edit-button" type="button" (click)="editMode = true" mat-menu-item i18n>Edit
      Post</button>
    <button name="discussion-post-delete-button" type="button" (click)="deletePost(deleteFailMsg.value)" mat-menu-item
      i18n>
      Delete Post
    </button>
  </ng-template>
</mat-menu>

<input type="hidden" i8n-value value="Something went wrong! Unable to delete." #deleteFailMsg />
<input type="hidden" i8n-value value="Something went wrong! Unable to post." #editFailMsg />